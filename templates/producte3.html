

{% extends "base.html" %}
{% block head %}
    <title>PANSON: {{ producte.nom }}</title>
{% endblock %}

{% block imports %}
    <link href='/style/contacte.css' as='style' rel='preload'>
    <link href='/style/galeria.css' as='style' rel='preload'>
    <link href='/scripts/galeria.js' as='script' rel='preload'>
    <link href='/style/talles.css' as='style' rel='preload'>
    <link href='/style/producte3.css' as='style' rel='preload'>
    <link href='/scripts/producte3.js' as='script' rel='preload'>
    
    <link href='/style/contacte.css' rel='stylesheet'>
    <link href='/style/galeria.css' rel='stylesheet'>
    <script defer type="text/javascript" src="/scripts/galeria.js"></script>
    <link href='/style/talles.css' rel='stylesheet'>
    <link href='/style/producte3.css' rel='stylesheet'>
    <script defer type="text/javascript" src="/scripts/producte3.js"></script>
{% endblock %}

{% import 'galeria.html' as galeria with context%}
{% import 'talles.html' as talles_macros with context%}

{% block body %}


<div class="content-producte">
    <div id="producte-images" class="slideshow">
    {% for n, imatge in utils.enumerate(producte.imatges) %}
            <div class="main-foto normal-image {{ 'fast-image' if n ==0 }}"  product="{{ producte.nom }}" onclick="enlargeImg(this)" background='{{ imgs.get_url(producte.bucket, imatge) }}'></div>
    {% endfor %}
    </div>
    <div class="bubble-container {{ 'hidden' if utils.len(producte.imatges) <= 1 }}">
    	<div class="bubbles">
	    {% for n, imatge in utils.enumerate(producte.imatges) %}
	    	<div class="bubble" onclick="slideshowScroll(this.parentElement.parentElement.previousElementSibling, '{{ n }}')"></div>
	    {% endfor %}
    	</div>
	<div class="arrows">
		<img class="main-arrow left" src="/static/media/arrow.svg" onclick="slideshowScroll(this.parentElement.parentElement.previousElementSibling, 'prev')">
		<img class="main-arrow right" src="/static/media/arrow.svg" onclick="slideshowScroll(this.parentElement.parentElement.previousElementSibling, 'next')">
	</div>

    </div>



    <div id="main-details">
        <div id="titol_producte">{{ producte.nom }}</div>
    {% if False %}
    <div class="pro-per-a"><span class="loc" loc="pro_per_a">{{ loc.pro_per_a }}</span>{{ producte.per_a }}</div>
    {% endif %}

    {% if producte.bucket == "productes" %}

        <div id="initial-price"> <span class="preu-producte"></span> &#8364;</div>


        <form method="post" enctype="multipart/form-data" id="form">
            <input value="{{ producte._id }}" name="id" style="display: none">
            <button id="close-options" type="button" class="popup-cross" onclick="hideBuyOptions()">X</button>
            <div id="buy-options">

            {% if producte.opcions["materials"] != None %}
                <fieldset class="materials-producte {{ "hide" if utils.len(producte.opcions["materials"].keys()) == 1 }}" >
			<legend class="loc" loc="pro_material">{{loc.pro_material }}</legend>
                    {% for n, (material, info) in utils.enumerate(producte.opcions["materials"].items()) %}
                        <div>
                            <input type="radio" name="material" price="{{ info.get("preu", 0) }}" class="material-input" value="{{ material }}" {{ "checked" if n==0 }}>
                            <label>{{ material }}</label>
                        </div>
                    {% endfor %}
                </fieldset>
            {% else %}
                        <input name="material" type="hidden" value="NA">
            {% endif %}


            {% if producte.opcions.get("n_colors", 0) >0 %}
                <div class="colors-producte option-field">
                    
                    <div class="options">
                        {% for n in range(producte.opcions.get("n_colors", 1)) %}
			<legend class="pro_color_titol"><span class="loc" loc="pro_color_singular">{{loc.pro_color_singular}}</span> {{n+1}}:
				{{ "("+loc[producte.opcions.get("extra_colors", [""]*n)[n]]+")" if producte.opcions.get("extra_colors", [""]*(n+1))[n] != "" }}</legend>

                            <fieldset class="color-selector colors-producte#{{ n }}">
                                {% for color, info in producte.opcions["colors"].items() %}
                                    <label title="{{ loc["color-"+color] }}" class="colour-label {{ producte.opcions.get("extra_colors", []*n)[n] }}" style="background-color:{{ loc["colours_"+color] }};" onclick="selectColour(this)">
                                    <input type="radio" name="color#{{ n }}" class="hidden-input color-input" price="{{ info.get("preu", 0) }}" value="{{ color }}">
                                    </label>
                                {% endfor %}
                            <input type="hidden" name="color#{{ n }}" class="color-input" value="" checked="true">
                            </fieldset >
                        {% endfor %}
                    </div>
                </div>
            {% else %}
                        <input name="color" type="hidden" value="NA">
            {% endif %}

            {% if producte.opcions["variacions"] != None %}
                <fieldset class="option-field variacions-producte {{ "hide" if utils.len(producte.opcions["variacions"].keys()) == 1 }}">
			<legend class="loc" loc="pro_variacio">{{loc.pro_variacio}}</legend>
                    <div class="options variations">
                    {% for n, (variacio, info) in utils.enumerate(utils.sort_by_keys(producte.opcions["variacions"], ["preu", "ordre"]).items()) %}
                        <div class="option variation">
                            <label class="text-label" onclick="selectVariation(this)">
                                <input type="radio" name="variacio" price="{{ info.get("preu", 0) }}" class="hidden-input variation-input" value="{{ variacio }}" {{ "checked=true" if n == 0 }}>
                            {{ variacio }}
                            </label>
                        </div>
                    {% endfor %}
                    </div>
                </fieldset>
            {% else %}
                        <input name="variacio" type="hidden" value="NA">
            {% endif %}


            {% if producte.opcions["talles"] != None or producte["totes_talles"] %}
                <fieldset class="talles-producte option-field" name="text:talla">
                <legend class="loc" loc="pro_talla">{{ loc.pro_talla }}</legend>
                    <div class="options talles">

                    {% if producte.opcions["talles"] %}
                            {% for n, (talla, info) in utils.enumerate(utils.sort_by_keys(producte.opcions["talles"], ["preu","ordre"]).items()) if talla not in ["XS", "S", "M", "L", "XL"] %}
                                <div class="option size">
                                    <label class="text-label">
                                        <input  type="radio" name="talla" price="{{ info.get("preu", 0) }}" qty="{{ info.get("qty", 0) }}" class="hidden-input size-input" value="{{ talla }}" onchange="selectSize(this);updatePrice()">
                                    {{ talla }}
                                    </label>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% if producte["totes_talles"]  %}
                        {% for talla in ["XS", "S", "M", "L", "XL"] %}
                            <div class="option size">
                                <label class="text-label">
                                {% if producte.opcions["talles"] != None %}
                                    {% if talla in producte.opcions.get("talles", {}).keys() %}
                                        <input  type="radio" name="talla" price="{{ producte.opcions["talles"][talla].get("preu", 0) }}" qty="{{ producte.opcions["talles"][talla].get("qty", 0) }}" class="hidden-input size-input" value="{{ talla }}" onchange="selectSize(this);updatePrice();">
                                    {% else %}
                                        <input  type="radio" name="talla" price="0" qty="0" class="hidden-input size-input" value="{{ talla }}" onchange="selectSize(this);updatePrice();">
                                    {% endif %}
                                {% else %}
                                    <input  type="radio" name="talla" price="0" qty="0" class="hidden-input size-input" value="{{ talla }}" onchange="selectSize(this);updatePrice();">
                                {% endif %}
                                    {{ talla }}
                                </label>
                            </div>
                        {% endfor %}
                    {% endif %}

                    {% if producte["totes_talles"] %}
                            <div id=custom-size class="show-size-selector option size" onclick="this.nextElementSibling.style.display='flex'; this.style.display='none';resizeSelector(this.nextElementSibling.lastElementChild);">{{ loc.pro_personalitza_talla }}</div>
                            <div class="multiple-input-span" style="display: none;"><input type="text" name="talla-multi" id=size-multiple-input class="talla talla-unica size-input multiple-input" oninput="selectSize(this); updatePrice();" placeholder="{{ loc.pro_talla_input }}" maxlength="4">
                                <select id=size-country name="talla-country" style="width: fit-content" onchange="resizeSelector(this);selectSize(this.previousElementSibling); updatePrice();">
                                    <option class="es" value="es" selected>ES</option>
                                    <option class="eu" value="eu">EU</option>
                                    <option class="mm-c" value="mm-c">mm (circumference)</option>
                                    <option class="mm-d" value="mm-d">mm (diametre)</option>
                                    <option class="us" value="us">US</option>
                                    

                                </select>
                            </div>
                    {% endif %}

                    </div>
                    <div id="info-talles" class="clickable under-hover" onclick="showPopup(this.nextElementSibling)">{{ loc.pro_graella_talles }}</div>
                        <div class="popup-info" id="popup-talles" onclick="event.stopPropagation()">
				{{ talles_macros.info_talles() }}
				
                        </div>

                </fieldset>
            {% else %}
                        <input name="talla" type="hidden" value="NA">
            {% endif %}











            </div>
             <div id="final-price"> <span class="preu-producte"></span> &#8364;</div>
	     <div class="add-to-cart black-button" onclick="submitToCart(this)">{{ loc.pro_afegir_carret}}
		     <div class="cart-loading slow-image" background="/static/media/loading.gif"></div>
	     </div>
            <div id="missatge-lent" class="missatge-enviament loc" style="display: none" loc="pro_enviament_lent">{{ loc.pro_enviament_lent }}</div>
            <div id="missatge-rapid" class="missatge-enviament loc" style="display: none" loc="pro_enviament_rapid">{{ loc.pro_enviament_rapid }}</div>
	    <div id="missing-info" class="popup-info loc" loc="pro_missing_details"><p>{{ loc.pro_missing_details }}</p></div>
        </form>
    {% endif %}
    <div id="product-description" >{{ producte.descripcio | safe}}</div>

    {% if producte.bucket == "productes" %}
    <div class="product-info">
            <div class="desplegable">
                <div class="titol-desplegable" onclick="showInfoDropdown(this, this.nextElementSibling, this.lastElementChild)"><div class="clickable under-hover loc" loc="pro_info_titol">{{ loc.pro_info_titol }}</div><div class="arrow">+</div></div>
                <div class="info-desplegable">
                    <p class="extra-info"> {{ producte.info | safe }}</p>
                    <p class="loc" loc="pro_info_text">{{ loc.pro_info_text | safe}}</p>
                </div>
            </div>
            <div class="desplegable">
                <div class="titol-desplegable" onclick="showInfoDropdown(this, this.nextElementSibling, this.lastElementChild)"><div class="clickable under-hover loc" loc="pro_cura_titol">{{ loc.pro_cura_titol }}</div><div class="arrow">+</div></div>
                <div class="info-desplegable">
                    <p class="loc" loc="pro_cura_text_1">{{ loc.pro_cura_text_1 | safe}}</p>
                    <div class="subtitol-desplegable loc" loc="pro_cura_subtitol">{{ loc.pro_cura_subtitol }}</div>
		    <p class="loc" loc="pro_cura_text_2">{{ loc.pro_cura_text_2 | safe}}</p>
                </div>
            </div>
            <div class="desplegable">
                <div class="titol-desplegable" onclick="showInfoDropdown(this, this.nextElementSibling, this.lastElementChild)"><div class="clickable under-hover loc" loc="pro_enviament_titol">{{ loc.pro_enviament_titol }}</div><div class="arrow">+</div></div>
                <div class="info-desplegable">
                    <p vlass="loc" loc="pro_enviament_text">{{ loc.pro_enviament_text_1 | safe}}</p>
                </div>
            </div>
        </div>
    {% endif %}
    {% if producte.bucket == "bespoke" %}
    <div class="explicacio-contacte loc" loc="pro_explicacio_contacte">{{ loc.pro_explicacio_contacte }}</div>
    	{% import 'contacte.html' as contacte with context%}
	{{ contacte.contact_form(prefix=False, subject=False) }}
    {% endif %}
    </div>
</div>

    {% if producte.bucket == "productes" %}
<div class="subtitol-galeria loc" loc="pro_titol_galeria">{{ loc.pro_tiol_galeria }}</div>

    <div class="producte-galeria galeries-landscape">
        {{ galeria.galeria("productes", filtres=False, filterKey="collecio;tipus", filterValue=utils.str(producte.collecio)+";"+utils.str(producte.tipus), min_row=1, min_prods=4, exclude=producte._id, filter_mode="|", inline=True) }}
    </div>

    <div class="producte-galeria galeries-portrait">
        {{ galeria.galeria("productes", filtres=False, filterKey="collecio", filterValue=utils.str(producte.collecio), min_row=1, min_prods=2, exclude=producte._id, inline=True) }}
        {{ galeria.galeria("productes", filtres=False, filterKey="tipus", filterValue=utils.str(producte.tipus), min_row=1, min_prods=2, exclude=producte._id, inline=True) }}
    </div>
    {% endif %}

{% endblock %}




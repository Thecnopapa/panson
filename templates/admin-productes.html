{% extends "admin-base.html" %}

{% block content %}
<div id="productes" class="admin-content">

	{% for product in productes.get_all() %}
		<div class="product-container">
        <div class="product-header" onclick="showData(this)">
            <button type="button" class="product-button product-hide {{ "hide" if product.amagat }}" product="{{product._id}}" field="amagat" value="True" dataType="bool" onclick="event.stopPropagation(productUpdate(this)); this.style.display='none'; this.nextElementSibling.style.display = 'block'; this.parentElement.getElementsByClassName('product-title')[0].innerHTML = this.parentElement.parentElement.getElementsByClassName('name')[0].firstElementChild.value + ' (Amagat)'">Amagar</button>
            <button type="button" class="product-button product-show {{ "hide" if not product.amagat }}" product="{{product._id}}" field="amagat" value="False" dataType="bool" onclick="event.stopPropagation(productUpdate(this)); this.style.display='none'; this.previousElementSibling.style.display = 'block'; this.parentElement.getElementsByClassName('product-title')[0].innerHTML = this.parentElement.parentElement.getElementsByClassName('name')[0].firstElementChild.value">Mostrar</button>
            <button type="button" class="product-button product-delete {{ "hide" if product.esborrat }}" product="{{product._id}}" field="esborrat" value="True" dataType="bool" onclick="event.stopPropagation(productUpdate(this)); this.parentElement.parentElement.remove()">ESBORRAR</button>

            <div class="product-title" >{{product.nom}} {{ "(Amagat)" if product.amagat }}</div>
            <div class="product-id">{{product._id}}</div>
            <div class="product-snapshot" style="background-image: url('{{ utils.img_url("productes", product.imatges[0]) }}')"></div>
        </div>
            <div class="product-data hide">
                <div class="product-element name">Nom: <input product="{{product._id}}" field="nom" class="product-input" value="{{product.nom}}" oninput="this.nextElementSibling.style.backgroundColor = 'yellow'; this.parentElement.parentElement.parentElement.getElementsByClassName('product-title')[0].innerHTML=this.value"><button class="product-update" onclick="productUpdate(this.previousElementSibling)">&#10004;</button></div>
                <div class="product-element subtitle">Subtitol: <input product="{{product._id}}" field="subtitol" class="product-input" value="{{product.subtitol}}" oninput="this.nextElementSibling.style.backgroundColor = 'yellow';"><button class="product-update" onclick="productUpdate(this.previousElementSibling)">&#10004;</button></div>

                <div class="product-element description">Descripcio: <textarea product="{{product._id}}" field="descripcio" class="product-input" oninput="this.nextElementSibling.style.backgroundColor = 'yellow';">{{product.descripcio}}</textarea><button class="product-update" onclick="productUpdate(this.previousElementSibling)">&#10004;</button></div>
                <div class="product-element type">Tipus:
                    <select product="{{product._id}}" field="tipus" class="product-input" oninput="productUpdate(this)">
                            <option value=""></option>
			    {% for tipus in loc.misc["types"] %}
                                <option value="{{ tipus }}" {{ "selected=selected" if tipus == product.tipus }}>{{ tipus }}</option>
                            {% endfor %}
                    </select><div></div>
                </div>
                <div class="product-element collection">Collecio:
                    <select product="{{product._id}}" field="collecio" class="product-input" oninput="productUpdate(this)">
			    <option value=""></option>
                            {% for collecio in productes.col_names %}
                                <option value="{{ collecio.lower() }}" {{ "selected=selected" if collecio.lower() == product.collecio }}>{{ collecio }}</option>
                            {% endfor %}
                    </select><div></div>
                </div>
                <div class="product-element collection">Unica:
                <select product="{{product._id}}" field="unica" dataType="bool" class="product-input" oninput="productUpdate(this);">
                            {% for b in [True, False] %}
                                <option value="{{ b }}" {{ "selected=selected" if product.unica == b }}>{{ loc.misc["bools"]["{}".format(b)] }}</option>
                            {% endfor %}
                </select><div></div>
                </div>


                <div class="product-element material">Material:<ul>
                            {% for n, (subkey, info) in utils.enumerate(utils.list(product.opcions.get("materials", {"": {"":""}}).items())) %}
                                <li>
                                    <input type="{{ "hidden" if product.opcions["materials"] }}" subdict="materials" class="dict-key" product="{{product._id}}" field="opcions" dataType="dict:text" value="{{ subkey }}"><span>{{ subkey }}</span>
                                    Preu: <input type="number" dataType="float" class="product-input dict-input" key="preu" value="{{ info["preu"] }}">
                                    <button class="product-update" onclick="productUpdateDict(this.parentElement, 'add')">&#10004;</button>
                                    <button class="product-update" onclick="productUpdateDict(this.parentElement, 'remove')">✖</button>
                                </li>
                            {% endfor %}
                        </ul><button type="button" onclick="addListElement(this.previousElementSibling, 'text')">+</button>
                </div>

                <div class="product-element variacio">Variacio:<ul>
                            {% for n, (subkey, info) in utils.enumerate(utils.list(product.opcions.get("variacions", {"": {"":""}}).items())) %}
                                <li>
                                    <input type="{{ "hidden" if product.opcions["variacions"] }}" subdict="variacions" class="dict-key" product="{{product._id}}" field="opcions" dataType="dict:text" value="{{ subkey }}"><span>{{ subkey }}</span>
                                    Preu: <input type="number" dataType="float" class="product-input dict-input" key="preu" value="{{ info["preu"] }}">
                                    <button class="product-update" onclick="productUpdateDict(this.parentElement, 'add')">&#10004;</button>
                                    <button class="product-update" onclick="productUpdateDict(this.parentElement, 'remove')">✖</button>
                                </li>
                            {% endfor %}
                        </ul><button type="button" onclick="addListElement(this.previousElementSibling, 'text')">+</button>
                </div>

                <div class="product-element talles">Talles:<ul>
                            {% for n, (subkey, info) in utils.enumerate(utils.list(product.opcions.get("talles", {"": {"":""}}).items())) %}
                                <li>
                                    <input type="{{ "hidden" if product.opcions["talles"] }}" subdict="variacions" class="dict-key" product="{{product._id}}" field="opcions" dataType="dict:text" value="{{ subkey }}"><span>{{ subkey }}</span>
                                    Quantitat: <input type="number" dataType="text" class="product-input dict-input" key="qty" value="{{ info["qty"] }}">
                                    <button class="product-update" onclick="productUpdateDict(this.parentElement, 'add')">&#10004;</button>
                                    <button class="product-update" onclick="productUpdateDict(this.parentElement, 'remove')">✖</button>
                                </li>
                            {% endfor %}
                        </ul><button type="button" onclick="addListElement(this.previousElementSibling, 'text')">+</button>
                </div>



                <!-- TODO: colors input -->



                <div class="product-images">
                    {% for image in product.imatges %}
                        <div class="product-image" product="{{product._id}}" field="imatges" value="{{ image }}" style="background-image: url('{{ utils.img_url("productes", image) }}')">
                            <button type=button class=product-image-left  onclick="productImageMove(this.parentElement, false)">&larr;</button>
                            <button type=button class=product-image-right onclick="productImageMove(this.parentElement, true)">&rarr;</button>
                            <button type=button class=product-image-delete onclick="productImageDelete(this.parentElement)">&#10008;</button>
                        </div>
                    {% endfor %}
                    <button class="product-image-add" onclick="triggerInput(this.firstElementChild)">&#10133;<input type="file" accept="image/*|video/*" name="file" multiple class="product-image-input" oninput="productAddImage(this)" field="imatges" product="{{product._id}}" ></button>
                </div>
            </div>
        </div>
	{%endfor%}
	<div class="product-container">
		<form action="/admin/productes/create" method="post">
			<div class="product-header" onclick="showData(this)">
				<input name=name class="product-title" placeholder="NOM">
				<input name=id class="product-id" placeholder="ID">
				<button type=submit>CREAR</button>
			</div>
		</form>
	</div>                                                                                  

</div>
{% endblock %}






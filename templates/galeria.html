


{% macro galeria(bucket, double=False, filtres=False, max_prods=None, filterKey=None, filterValue=None, min_row=4, min_prods=4, exclude=None, filter_mode="&", pages=False, inline=False, load_more=False, go_to_shop=False, range=(0,1)) %}


{% set productes = productes.__getattribute__(bucket) %}


{% set prods = utils.filter_by_attr(productes, filterKey, filterValue, mode=filter_mode) %}
{% set prods = utils.filter_by_attr(prods, "_id", exclude, mode="!&") %}


{% set initial_prods_length = utils.len(prods) %}
{% set final_prods_length = utils.len(prods[utils.int(initial_prods_length*range[0]):utils.int(initial_prods_length*range[1])]) %}

{% if max_prods == None %}
	{% set max_prods = utils.len(prods[utils.int(initial_prods_length*range[0]):utils.int(initial_prods_length*range[1])]) %}
{% endif %}




<div class="content-galeria" page=0>
<div class="hidden-product-list">
	<div class="gallery-info" double="{{ doble_galeria }}" maxProds="{{ max_prods }}" minRow="{{ min_row }}" bucket="{{ bucket }}" filterKey="None" filterValue="None" nProds="{{final_prods_length}}"></div>

    {% for n, producte in utils.enumerate(prods[utils.int(initial_prods_length*range[0]):utils.int(initial_prods_length*range[1])]) %}
    <div class="hidden-info-producte" 
	    id="{{ producte._id }}" 
	    nom="{{ producte.nom }}" 
	    preu="{{ producte.calcular_preu_minim() }}&#8364;" 
	    col="{{ producte.collecio }}" 
	    tipus="{{ producte.tipus }}" 
	    unica="{{ producte.unica }}" 
	    novetat="{{ producte.novetat }}"
	    popular="{{ producte.popular }}"
	    material="{{ utils.join("&", producte.opcions["materials"].keys()) if producte.opcions['materials'] != None}}"
	    img1="{{ producte.imatges[0] }}" 
	    img2="{{ producte.imatges[1] }}"
	    {% if bucket == "bespoke" %}
	    per_a="{{ loc.fam_per_a }} {{ producte.per_a }}"
	    {% endif %}
	    ></div>
    {% endfor %}
</div>

        {% if filtres %}
            <div class="filtre-buttons">
                <div class="filtre-buttons-gradient"></div>
                {% for n, filtre in utils.enumerate(loc.filtres) %}
                    <div class="filtre {{ "first" if n==0 }} {{ "last" if n+1 == utils.len(loc.filtres) }}" filterKey="{{ filtre["field"] }}" filterValue="{{ filtre["value"] }}" onclick="filterGaleria(this)">{{ loc[filtre["nom"]] }}</div>
                {% endfor %}
            </div>

        {% endif %}
    <div class="galeria-scroll scroll-left {{ 'inline' if inline }}" >
	    <div class="galeria-scroll-button scroll-left-button disabled {{"invisible" if final_prods_length <= min_row }}" onclick="scrollGallery(this.parentElement.nextElementSibling.nextElementSibling, 'left', '1u')"><img class="main-arrow left" src="/static/media/arrow.svg"></div>
    </div>
    <div class="galeria-scroll scroll-right {{ 'inline' if inline }}" >
	    <div class="galeria-scroll-button scroll-right-button {{ "invisible" if final_prods_length <= min_row }}" onclick="scrollGallery(this.parentElement.nextElementSibling, 'right', '1u')"><img class="main-arrow right" src="/static/media/arrow.svg"></div>
    </div>
    <div class="galeria {{ 'inline' if inline }}">
            <div class="producte template empty {{ 'inline' if inline }}" onmouseover="highlightProduct(this)" onmouseout="reverseProduct(this)">
               <div class="imatge primera normal-image" onmouseover="//highlightProduct(this)"></div>
               <div class="imatge segona slow-image preload" onmouseout="//reverseProduct(this)"></div>
               <div class="detalls-galeria">
                    <div class="detalls-principals">
                        {% if bucket == "bespoke" %}
                            <div class="per-a"></div>
                        {% else %}
                            <div class="nom"></div>
                            <div class="preu-inline"></div>
                           {# <div style="width:fit-content; display: flex;" class="preu-inline-slash portrait">&nbsp;/&nbsp;<div class="preu-inline"></div></div>#}
                        {% endif %}
                    </div>
                </div>
           </div>
    </div>

    <div class="galeria-navigation" pages="{{pages}}" more="{{load_more }}" goToShop="{{go_to_shop}}">
	{% if pages %}
	    <img class="main-arrow page-arrow left" src="/static/media/arrow.svg" onclick="galeriaPrev(this.parentElement.parentElement)">
	    <div class="galeria-counter"></div>
	    <img class="main-arrow page-arrow right" src="/static/media/arrow.svg" onclick="galeriaNext(this.parentElement.parentElement)">
	{% elif load_more %}
	    <div class="galeria-load-more galeria-nav-button black-button loc" loc="gal_carregar_mes" onclick="galeriaNext(this.parentElement.parentElement)">{{ loc.gal_carregar_mes}}</div>
	{% elif go_to_shop %}
	    <div class="galeria-go-to-shop galeria-nav-button black-button loc" loc="gal_anar_botiga" onclick="location.href='/{{ loc.lan }}/productes'">{{ loc.gal_anar_botiga}}</div>
	{% endif %}
    </div>
</div>
{% endmacro %}
